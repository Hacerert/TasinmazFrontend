<!-- Kullanıcı Yönetimi - Kompakt Tasarım -->
<div class="container mx-auto p-4 bg-gray-50 min-h-screen">
  <div class="mb-4 border-b border-gray-200 pb-3">
    <div class="flex justify-between items-center">
      <h1 class="text-2xl font-bold text-gray-900">Kullanıcı Yönetimi</h1>
      <div class="flex space-x-2">
        <!-- Sağ Üst Butonlar -->
        <button (click)="goToTasinmazlar()" class="btn btn-sm btn-purple">🏘️ Taşınmaz</button>
        <button (click)="viewLogs()" class="btn btn-sm btn-cyan">📋 Log</button>
        <button (click)="logout()" class="btn btn-sm btn-red">Çıkış</button>
      </div>
    </div>
  </div>

  <!-- Hata Mesajı -->
  <div *ngIf="error" class="bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded mb-4" role="alert">
    <strong class="font-bold">Hata!</strong> {{ error }}
  </div>

  <!-- Yükleniyor Mesajı -->
  <div *ngIf="loading" class="text-center py-8 text-gray-600">Yükleniyor...</div>

  <!-- Tablo Üstü İşlem Butonları -->
  <div *ngIf="!loading && users.length > 0" class="mb-3 flex justify-end space-x-2">
    <button (click)="addNewUser()" class="btn btn-sm btn-blue">+ Kullanıcı Ekle</button>
    <button (click)="deleteSelectedUsers()" [disabled]="selectedUserIds.length === 0" class="btn btn-sm btn-red">Sil ({{selectedUserIds.length}})</button>
    <button (click)="exportSelectedToExcel()" [disabled]="selectedUserIds.length === 0" class="btn btn-sm btn-green">📊 Seçilenleri Excel'e Aktar</button>
  </div>

  <!-- Kompakt Filtreleme Bölümü -->
  <div *ngIf="!loading && users.length > 0" class="mb-3 bg-white rounded shadow p-3">
    <div class="flex items-center gap-3">
      <!-- Kullanıcı Adı Filtresi -->
      <input 
        [(ngModel)]="filterUsername" 
        (input)="applyFilters()"
        placeholder="Kullanıcı adı" 
        class="compact-input">
      
      <!-- Email Filtresi -->
      <input 
        [(ngModel)]="filterEmail" 
        (input)="applyFilters()"
        placeholder="Email" 
        class="compact-input">
      
      <!-- Rol Filtresi -->
      <select 
        [(ngModel)]="filterRole" 
        (change)="applyFilters()"
        class="compact-select">
        <option value="">Tüm Roller</option>
        <option value="Admin">Admin</option>
        <option value="User">User</option>
      </select>
      
      <!-- Filtre Butonları -->
      <button (click)="applyFilters()" class="btn btn-sm btn-blue">Ara</button>
      <button (click)="clearFilters()" class="btn btn-sm btn-gray">Temizle</button>
    </div>
  </div>

  <!-- Kompakt Kullanıcılar Tablosu -->
  <div *ngIf="!loading && filteredUsers.length > 0" class="bg-white rounded shadow">
    <table class="w-full text-sm">
      <thead>
        <tr class="bg-gray-100 text-gray-700 text-xs uppercase font-medium">
          <th class="px-3 py-2 text-left">
            <input type="checkbox" (change)="toggleSelectAll($event)">
          </th>
          <th class="px-3 py-2 text-left">ID</th>
          <th class="px-3 py-2 text-left">Kullanıcı</th>
          <th class="px-3 py-2 text-left">Email</th>
          <th class="px-3 py-2 text-left">Rol</th>
          <th class="px-3 py-2 text-center">İşlem</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of filteredUsers" class="border-b hover:bg-gray-50">
          <td class="px-3 py-2">
            <input type="checkbox" [checked]="selectedUserIds.includes(user.id!)" (change)="onCheckboxChange(user.id!, $event)">
          </td>
          <td class="px-3 py-2">{{ user.id }}</td>
          <td class="px-3 py-2">{{ user.userName }}</td>
          <td class="px-3 py-2">{{ user.email || '-' }}</td>
          <td class="px-3 py-2">
            <span class="px-2 py-1 text-xs rounded" [class]="user.role === 'Admin' ? 'bg-purple-100 text-purple-800' : 'bg-blue-100 text-blue-800'">
              {{ user.role }}
            </span>
          </td>
          <td class="px-3 py-2 text-center">
            <!-- DÜZENLE BUTONU BURADA GÜNCELLENDİ -->
            <button (click)="editUser(user.id)"
                    class="transition duration-150 transform hover:scale-110 focus:outline-none"
                    style="border: none; background: unset; color: #737373; cursor: pointer;"
                    title="Düzenle">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
              </svg>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Kullanıcı Yok Mesajı -->
  <div *ngIf="!loading && users.length === 0 && !error" class="text-center py-8 text-gray-600 bg-white rounded">
    <p class="font-medium mb-2">Henüz kullanıcı bulunmuyor.</p>
    <p class="text-sm">Yeni kullanıcılar eklendiğinde burada görünecek.</p>
  </div>
</div>
